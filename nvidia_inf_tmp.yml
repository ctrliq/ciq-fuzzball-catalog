 echo "\x76657273696f6e3a2076310a6a6f62733a0a20206e76696469612d6e696d3a0a20202020656e763a0a2020202020202d204e47435f4150495f4b45593d7b7b2e4e6763456e765661725365637265747d7d0a2020202020202d204e494d5f475250435f4150495f504f52543d7b7b2e4e696d47727063506f72747d7d0a2020202020202d204e494d5f485454505f4150495f504f52543d7b7b2e4e696d48747470506f72747d7d0a2020202020202d204e494d5f43414348455f504154483d7b7b2e4e696d4361636865506174687d7d0a2020202020202d204e494d5f4d414e49464553545f50524f46494c453d7b7b2e4e696d4d616e696665737450726f66696c657d7d0a20202020696d6167653a0a2020202020207572693a207b7b2e4e696d496d6167655572697d7d0a2020202020207365637265743a207b7b2e4e67634f63695365637265747d7d0a202020206d6f756e74733a0a202020202020646174613a0a20202020202020206c6f636174696f6e3a202f646174610a20202020202063616368653a0a20202020202020206c6f636174696f6e3a202f686f6d652f6e76730a20202020706f6c6963793a0a20202020202074696d656f75743a0a2020202020202020657865637574653a207b7b2e54696d656f75747d7d0a20202020636f6d6d616e643a0a2020202020202d202f62696e2f73680a2020202020202d20272d63270a2020202020202d206e76696469612d736d693b202f6f70742f6e76696469612f6e76696469615f656e747279706f696e742e73682073746172745f7365727665723b0a202020207265736f757263653a0a2020202020206370753a0a2020202020202020636f7265733a207b7b2e436f7265737d7d0a2020202020202020616666696e6974793a204e554d410a2020202020206d656d6f72793a0a202020202020202073697a653a207b7b2e4d656d6f72797d7d0a202020202020646576696365733a0a20202020202020206e76696469612e636f6d2f6770753a207b7b2e475055737d7d0a766f6c756d65733a0a2020646174613a0a202020207265666572656e63653a207b7b2e4d6f64656c5265706f44617461566f6c756d657d7d0a202063616368653a0a202020207265666572656e63653a207b7b2e4d6f64656c4361636865566f6c756d657d7d0a" | xxd -r -p
 
version: v1
jobs:
  nvidia-nim:
    env:
      - NGC_API_KEY={{.NgcEnvVarSecret}}
      - NIM_GRPC_API_PORT={{.NimGrpcPort}}
      - NIM_HTTP_API_PORT={{.NimHttpPort}}
      - NIM_CACHE_PATH={{.NimCachePath}}
      - NIM_MANIFEST_PROFILE={{.NimManifestProfile}}
    image:
      uri: {{.NimImageUri}}
      secret: {{.NgcOciSecret}}
    mounts:
      data:
        location: /data
      cache:
        location: /home/nvs
    policy:
      timeout:
        execute: {{.Timeout}}
    command:
      - /bin/sh
      - '-c'
      - nvidia-smi; /opt/nvidia/nvidia_entrypoint.sh start_server;
    resource:
      cpu:
        cores: {{.Cores}}
        affinity: NUMA
      memory:
        size: {{.Memory}}
      devices:
        nvidia.com/gpu: {{.GPUs}}
volumes:
  data:
    reference: {{.ModelRepoDataVolume}}
  cache:
    reference: {{.ModelCacheVolume}}